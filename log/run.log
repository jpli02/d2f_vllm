Found LoRA config: r=32, alpha=32
Loading base model:   0%|          | 0/4 [00:00<?, ?it/s]Loading base model:  25%|██▌       | 1/4 [00:00<00:01,  2.03it/s]Loading base model:  75%|███████▌  | 3/4 [00:01<00:00,  2.84it/s]Loading base model: 100%|██████████| 4/4 [00:01<00:00,  2.55it/s]Loading base model: 100%|██████████| 4/4 [00:01<00:00,  2.55it/s]
Loading LoRA weights from /home/jyj/workspace-2/D2F/lora_weight
Loading LoRA:   0%|          | 0/1 [00:00<?, ?it/s]Loading LoRA: 100%|██████████| 1/1 [00:00<00:00, 61.27it/s]
LoRA weights applied to 112 layers and merged
Generating:   0%|          | 0/5 [00:00<?, ?it/s]Generating:   0%|          | 0/5 [00:03<?, ?it/s, Prefill=42tok/s, Decode=0tok/s]Generating:   0%|          | 0/5 [00:05<?, ?it/s, Prefill=42tok/s, Decode=2tok/s]Generating:   0%|          | 0/5 [00:05<?, ?it/s, Prefill=42tok/s, Decode=184tok/s]Generating:   0%|          | 0/5 [00:06<?, ?it/s, Prefill=42tok/s, Decode=7tok/s]  Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=5tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=72tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=146tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=72tok/s] Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=87tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=88tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=72tok/s]Generating:   0%|          | 0/5 [00:08<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=73tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=88tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=146tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=116tok/s]Generating:   0%|          | 0/5 [00:09<?, ?it/s, Prefill=42tok/s, Decode=117tok/s]Generating:   0%|          | 0/5 [00:10<?, ?it/s, Prefill=42tok/s, Decode=4tok/s]  Generating:   0%|          | 0/5 [00:11<?, ?it/s, Prefill=42tok/s, Decode=4tok/s]Generating:   0%|          | 0/5 [00:13<?, ?it/s, Prefill=42tok/s, Decode=4tok/s]Generating:   0%|          | 0/5 [00:13<?, ?it/s, Prefill=42tok/s, Decode=117tok/s]Generating:   0%|          | 0/5 [00:14<?, ?it/s, Prefill=42tok/s, Decode=5tok/s]  Generating:   0%|          | 0/5 [00:14<?, ?it/s, Prefill=42tok/s, Decode=98tok/s][rank0]:W0727 13:51:32.198000 2655430 torch/_dynamo/convert_frame.py:964] [2/8] torch._dynamo hit config.recompile_limit (8)
[rank0]:W0727 13:51:32.198000 2655430 torch/_dynamo/convert_frame.py:964] [2/8]    function: 'inner' (/data1/jyj/D2F/.venv/lib/python3.12/site-packages/torch/_dynamo/external_utils.py:68)
[rank0]:W0727 13:51:32.198000 2655430 torch/_dynamo/convert_frame.py:964] [2/8]    last reason: 2/7: tensor 'args[0]' size mismatch at index 2. expected 352, actual 320
[rank0]:W0727 13:51:32.198000 2655430 torch/_dynamo/convert_frame.py:964] [2/8] To log all recompilation reasons, use TORCH_LOGS="recompiles".
[rank0]:W0727 13:51:32.198000 2655430 torch/_dynamo/convert_frame.py:964] [2/8] To diagnose recompilation issues, see https://pytorch.org/docs/main/torch.compiler_troubleshooting.html.
Generating:   0%|          | 0/5 [00:14<?, ?it/s, Prefill=42tok/s, Decode=22tok/s]Generating:   0%|          | 0/5 [00:14<?, ?it/s, Prefill=42tok/s, Decode=48tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=20tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=16tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:15<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=35tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:16<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=63tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:17<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:18<?, ?it/s, Prefill=42tok/s, Decode=62tok/s]Generating:   0%|          | 0/5 [00:18<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:18<?, ?it/s, Prefill=42tok/s, Decode=26tok/s]Generating:   0%|          | 0/5 [00:18<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=23tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:19<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:20<?, ?it/s, Prefill=42tok/s, Decode=13tok/s]Generating:   0%|          | 0/5 [00:20<?, ?it/s, Prefill=42tok/s, Decode=36tok/s]Generating:   0%|          | 0/5 [00:20<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:20<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:20<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=38tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=54tok/s]Generating:   0%|          | 0/5 [00:21<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:22<?, ?it/s, Prefill=42tok/s, Decode=22tok/s]Generating:   0%|          | 0/5 [00:22<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:22<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:22<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:22<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=94tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:23<?, ?it/s, Prefill=42tok/s, Decode=95tok/s]Generating:   0%|          | 0/5 [00:24<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:24<?, ?it/s, Prefill=42tok/s, Decode=32tok/s]Generating:   0%|          | 0/5 [00:24<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:25<?, ?it/s, Prefill=42tok/s, Decode=53tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=25tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=63tok/s]Generating:   0%|          | 0/5 [00:26<?, ?it/s, Prefill=42tok/s, Decode=55tok/s]Generating:   0%|          | 0/5 [00:27<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:27<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:27<?, ?it/s, Prefill=42tok/s, Decode=25tok/s]Generating:   0%|          | 0/5 [00:27<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=48tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:28<?, ?it/s, Prefill=42tok/s, Decode=63tok/s]Generating:   0%|          | 0/5 [00:29<?, ?it/s, Prefill=42tok/s, Decode=22tok/s]Generating:   0%|          | 0/5 [00:29<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:29<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:29<?, ?it/s, Prefill=42tok/s, Decode=22tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=38tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=38tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:30<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=22tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=54tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=54tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=54tok/s]Generating:   0%|          | 0/5 [00:31<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:32<?, ?it/s, Prefill=42tok/s, Decode=34tok/s]Generating:   0%|          | 0/5 [00:32<?, ?it/s, Prefill=42tok/s, Decode=18tok/s]Generating:   0%|          | 0/5 [00:32<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:32<?, ?it/s, Prefill=42tok/s, Decode=54tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=60tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=68tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=61tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=83tok/s]Generating:   0%|          | 0/5 [00:33<?, ?it/s, Prefill=42tok/s, Decode=18tok/s]Generating:   0%|          | 0/5 [00:34<?, ?it/s, Prefill=42tok/s, Decode=19tok/s]Generating:   0%|          | 0/5 [00:34<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:35<?, ?it/s, Prefill=42tok/s, Decode=46tok/s]Generating:   0%|          | 0/5 [00:35<?, ?it/s, Prefill=42tok/s, Decode=50tok/s]Generating:   0%|          | 0/5 [00:35<?, ?it/s, Prefill=42tok/s, Decode=58tok/s]Generating:   0%|          | 0/5 [00:35<?, ?it/s, Prefill=42tok/s, Decode=43tok/s]Generating:   0%|          | 0/5 [00:35<?, ?it/s, Prefill=42tok/s, Decode=18tok/s]Generating:   0%|          | 0/5 [00:36<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:36<?, ?it/s, Prefill=42tok/s, Decode=39tok/s]Generating:   0%|          | 0/5 [00:36<?, ?it/s, Prefill=42tok/s, Decode=47tok/s]Generating:   0%|          | 0/5 [00:36<?, ?it/s, Prefill=42tok/s, Decode=50tok/s]Generating:   0%|          | 0/5 [00:36<?, ?it/s, Prefill=42tok/s, Decode=43tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=18tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=45tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=37tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=45tok/s]Generating:   0%|          | 0/5 [00:37<?, ?it/s, Prefill=42tok/s, Decode=67tok/s]Generating:   0%|          | 0/5 [00:38<?, ?it/s, Prefill=42tok/s, Decode=52tok/s]Generating:   0%|          | 0/5 [00:38<?, ?it/s, Prefill=42tok/s, Decode=52tok/s]Generating:   0%|          | 0/5 [00:38<?, ?it/s, Prefill=42tok/s, Decode=38tok/s]Generating:   0%|          | 0/5 [00:38<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:38<?, ?it/s, Prefill=42tok/s, Decode=45tok/s]Generating:   0%|          | 0/5 [00:39<?, ?it/s, Prefill=42tok/s, Decode=44tok/s]Generating:   0%|          | 0/5 [00:39<?, ?it/s, Prefill=42tok/s, Decode=44tok/s]Generating:   0%|          | 0/5 [00:39<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:39<?, ?it/s, Prefill=42tok/s, Decode=40tok/s]Generating:   0%|          | 0/5 [00:40<?, ?it/s, Prefill=42tok/s, Decode=37tok/s]Generating:   0%|          | 0/5 [00:40<?, ?it/s, Prefill=42tok/s, Decode=44tok/s]Generating:   0%|          | 0/5 [00:40<?, ?it/s, Prefill=42tok/s, Decode=44tok/s]Generating:   0%|          | 0/5 [00:40<?, ?it/s, Prefill=42tok/s, Decode=74tok/s]Generating:   0%|          | 0/5 [00:40<?, ?it/s, Prefill=42tok/s, Decode=15tok/s]Generating:   0%|          | 0/5 [00:41<?, ?it/s, Prefill=42tok/s, Decode=21tok/s]Generating:   0%|          | 0/5 [00:41<?, ?it/s, Prefill=42tok/s, Decode=52tok/s]Generating:   0%|          | 0/5 [00:41<?, ?it/s, Prefill=42tok/s, Decode=52tok/s][rank0]: Traceback (most recent call last):
[rank0]:   File "/data1/jyj/D2F/demo/test_dream_dvllm.py", line 42, in <module>
[rank0]:     outputs = llm.generate(prompts, sampling_params)
[rank0]:               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/data1/jyj/D2F/d2f_vllm/engine/llm_engine.py", line 88, in generate
[rank0]:     output, num_tokens, is_prefill = self.step()
[rank0]:                                      ^^^^^^^^^^^
[rank0]:   File "/data1/jyj/D2F/d2f_vllm/engine/llm_engine.py", line 59, in step
[rank0]:     seqs, is_prefill = self.scheduler.schedule()
[rank0]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/data1/jyj/D2F/d2f_vllm/engine/scheduler.py", line 150, in schedule
[rank0]:     self.block_manager.may_append(seq)
[rank0]:   File "/data1/jyj/D2F/d2f_vllm/engine/block_manager.py", line 136, in may_append
[rank0]:     assert last_block.hash != -1
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^
[rank0]: AssertionError
Generating:   0%|          | 0/5 [00:42<?, ?it/s, Prefill=42tok/s, Decode=52tok/s]
